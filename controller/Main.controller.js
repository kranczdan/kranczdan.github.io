sap.ui.define(["test/controller/BaseController","sap/ui/model/json/JSONModel","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/model/Sorter","sap/ui/core/Fragment"],function(e,t,i,n,o,s){"use strict";return e.extend("test.controller.Main",{onInit:function(){this.getOwnerComponent().getRouter().getRoute("Main").attachPatternMatched(this.onPatternMatched,this);this.setContentDensity();this.bSorted=true;this.sSortText="Nach Name aufsteigend sortiert"},onAfterRendering:function(){this.getView().setModel(new t({keys:["Vollkasko","Teilkasko"],range:[0,500]}),"filter")},onPatternMatched:function(){let e=false;if(this.getView().byId("idTable").getSelectedContexts().length>1){e=true}this.getView().setModel(new t({itemsLength:this.getView().byId("idTable").getItems().length,compareEnabled:e,fBExpanded:false,sorted:this.bSorted,sortText:this.sSortText}),"detail")},onTableSelectionChanged:function(e){if(this.getView().byId("idTable").getSelectedContexts().length>1){this.getView().getModel("detail").setProperty("/compareEnabled",true)}else{this.getView().getModel("detail").setProperty("/compareEnabled",false)}},onNavToDetail:function(e){this.getOwnerComponent().getRouter().navTo("Detail",{id:e.getSource().getBindingContext().getPath().split("/")[2]})},onSearch:function(){let e=[];let t=this.getView().getModel("filter").getData();if(t.keys.length!==0){t.keys.forEach(t=>{e.push(new i("type",n.EQ,t))})}if(t.range.length!==0){let o=[];o.push(new i("pricePerMonth",n.GE,t.range[0]));o.push(new i("pricePerMonth",n.LE,t.range[1]));e.push(new i(o,true))}this.getView().byId("idTable").getBinding("items").filter(e)},onReset:function(){this.getView().setModel(new t({keys:["Vollkasko","Teilkasko"],range:[0,500]}),"filter");this.onSearch()},onCompare:function(e){let t=this.getView().byId("idTable").getSelectedContexts();let i="";t.forEach(e=>{i+=e.getPath().split("/")[2]+";"});this.getOwnerComponent().getRouter().navTo("Compare",{ids:i.slice(0,-1)})},onOpenSort:function(){var e=this.getView();if(!this._oSortDialog){s.load({id:e.getId(),name:"test.view.Sort",controller:this}).then(function(t){this._oSortDialog=t;jQuery.sap.syncStyleClass(e.getController().getContentDensityClass(),e,t);this.getView().addDependent(this._oSortDialog);this._oSortDialog.open()}.bind(this))}else{this._oSortDialog.open()}},handleSort:function(e){var t=e.getParameters().sortItem.getKey();var i=e.getParameters().sortItem.getText();var n=e.getParameters().sortDescending;var s=new o({path:t,descending:n});this.sSortText="Nach "+i+" "+(n?"absteigend":"aufsteigend")+" sortiert";this.getView().getModel("detail").setProperty("/sortText",this.sSortText);this.getView().byId("idTable").getBinding("items").sort(s)}})});